!function(e,t,s){"use strict";({id:"x-video-controls",version:.1,classes:{active:"_active",fullscreen:"fullscreen",overlayPlayer:"x-player-overlay"},selectors:{contentBanner:".x-content-banner",videoComponent:"[data-video]",vidInner:".x-video-inner",closeBtn:".x-player-close-btn",shortcutsCloseBtn:".x-shortcuts-close-btn",player:"video.x-player-video",playBtn:".x-controls-button--play",pauseBtn:".x-controls-button--pause",muteBtn:".x-controls-button--mute",unmuteBtn:".x-controls-button--unmute",captionOnBtn:".x-controls-button--captionon",captionOffBtn:".x-controls-button--captionoff",shortcutsBtn:".x-controls-button--shortcuts",fullscreenOnBtn:".x-controls-button--fullscreenon",fullscreenOffBtn:".x-controls-button--fullscreenoff",volumeControls:".x-controls-volume-group",inputTime:".x-controls-inputtime",volumeBar:".x-controls-hidden-range--volume",seekBar:".x-controls-hidden-range--seek",notification:".x-player-notification",rangeHandle:".x-range-control-handle",rangeThermometer:".x-range-control-thermometer",rangeFill:".x-range-control-fill",controlsGroup:".x-controls-group",ariaLive:".x-accessibility-info",shortcutsInfo:".x-player-shortcuts-container",focusable:"a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]"},templateOptions:{interpolate:/{{([\s\S]+?)}}/g},md:new MobileDetect(window.navigator.userAgent),$dragTarg:null,$fullscreenTarg:null,notificationTimeout:null,controlsTimeout:null,hideDelay:2e3,initialize:function(){this.selectors.component='[data-component="'+this.id+'"]',_.forEach(this.classes,_.bind(function(e,t){this.selectors[t]="."+e},this)),this.bindListeners()},updateTime:function(t){var s=e(t.target),o=s[0].value,i=s.closest(this.selectors.videoComponent).find(this.selectors.player)[0];s.closest(this.selectors.vidInner).find(this.selectors.ariaLive);i.currentTime=o/100*i.duration,s.attr("aria-valuetext","Time "+this.toAccessibleTime(i.currentTime)+" of "+this.toAccessibleTime(i.duration))},onTimeUpdate:function(t){var s=e(t.target)[0],o=e(t.target).closest(this.selectors.videoComponent);if(o.length){var i=o.find(this.selectors.seekBar),n=100/s.duration*s.currentTime;i.attr("value",Math.round(n)),this.updateRangeControl(i,n);var r=(o.find(this.selectors.inputTime),this.secondsToMinutes(s.currentTime)),l=o.find(".x-controls-currenttime");l.html(r),this.md.mobile()&&l.attr("aria-label","Time: "+this.toAccessibleTime(s.currentTime))}},onDurationChange:function(t){var s=e(t.target)[0];e(t.target).closest(this.selectors.videoComponent).find(".x-controls-duration").html(this.secondsToMinutes(s.duration)).attr("aria-label","Duration: "+this.toAccessibleTime(s.duration))},onPlayClick:function(t){e(t.target).closest(this.selectors.videoComponent).find(this.selectors.player)[0].play()},onPlay:function(t){var s=e(t.target),o=s.closest(this.selectors.videoComponent),i=(o.find(this.selectors.player),o.find(this.selectors.playBtn)),n=o.find(this.selectors.pauseBtn),r=o.find(this.selectors.ariaLive);n.show(),i.is(":focus")&&this.focus(n),i.hide();var l=o.find(this.selectors.notification);l.addClass("x-player-notification--play show").removeClass("x-player-notification--pause"),clearTimeout(this.notificationTimeout),this.notificationTimeout=setTimeout(function(){l.removeClass("show")},1500),r.text("Video playing")},onPauseClick:function(t){e(t.target).closest(this.selectors.videoComponent).find(this.selectors.player)[0].pause()},onPause:function(t){var s=e(t.target),o=s.closest(this.selectors.videoComponent),i=(o.find(this.selectors.player),o.find(this.selectors.playBtn)),n=o.find(this.selectors.pauseBtn),r=o.find(this.selectors.ariaLive);i.show(),n.is(":focus")&&this.focus(i),n.hide();var l=o.find(this.selectors.notification);l.removeClass("x-player-notification--play").addClass("x-player-notification--pause show").show(),clearTimeout(this.notificationTimeout),this.notificationTimeout=setTimeout(function(){l.removeClass("show")},1500),r.text("Video paused")},togglePlayPause:function(t){var s=e(t.target).closest(this.selectors.videoComponent),o=s.find(this.selectors.player)[0];s.hasClass("x--background-mode")||(o.paused?(s.find(this.selectors.playBtn).focus(),o.play()):(s.find(this.selectors.pauseBtn).focus(),o.pause()))},onMuteClick:function(t){var s=e(t.target),o=s.closest(this.selectors.videoComponent),i=o.find(this.selectors.player)[0],n=o.find(this.selectors.ariaLive);i.volume=0;var r=o.find(this.selectors.muteBtn),l=o.find(this.selectors.unmuteBtn);r.hide(),l.show().focus(),n.text("Muted")},onUnmuteClick:function(t){var s=e(t.target),o=s.closest(this.selectors.videoComponent),i=o.find(this.selectors.player)[0],n=o.find(this.selectors.ariaLive);i.volume=1;var r=o.find(this.selectors.muteBtn);o.find(this.selectors.unmuteBtn).hide(),r.show().focus(),n.text("Unmuted")},updateVolume:function(t){var s=e(t.target),o=s[0].value;s.closest(this.selectors.videoComponent).find(this.selectors.player)[0].volume=o,s.attr("aria-valuetext","Volume "+Math.round(100*o)+"%")},onVolumeChange:function(t){var s=t.target,o=e(s).closest(this.selectors.videoComponent),i=o.find(this.selectors.muteBtn),n=o.find(this.selectors.unmuteBtn);0==s.volume?(n.show(),i.is(":focus")&&n.focus(),i.hide()):(i.show(),n.is(":focus")&&i.focus(),n.hide());var r=o.find(this.selectors.volumeBar);r.attr("value",s.volume),r.attr("aria-valuetext","Volume "+Math.round(100*s.volume)+"%"),this.updateRangeControl(r,s.volume,!0)},openVolumeControls:function(t){e(t.target).closest(this.selectors.volumeControls).addClass("open")},closeVolumeControls:function(t){e(t.target).closest(this.selectors.volumeControls).removeClass("open")},onCaptionShowClick:function(t){var s=e(t.target),o=s.closest(this.selectors.videoComponent),i=o.find(this.selectors.player)[0],n=o.find(this.selectors.captionOnBtn),r=o.find(this.selectors.captionOffBtn),l=s.closest(this.selectors.vidInner).find(this.selectors.ariaLive);i.textTracks[0].mode="showing",r.show(),n.is(":focus")&&this.focus(r),n.hide(),l.text("Closed captions on")},onCaptionHideClick:function(t){var s=e(t.target),o=s.closest(this.selectors.videoComponent),i=o.find(this.selectors.player)[0],n=o.find(this.selectors.captionOnBtn),r=o.find(this.selectors.captionOffBtn),l=s.closest(this.selectors.vidInner).find(this.selectors.ariaLive);i.textTracks[0].mode="hidden",n.show(),r.is(":focus")&&this.focus(n),r.hide(),l.text("Closed captions off")},toggleFullscreen:function(s){var o=e(s.target),i=o.closest(this.selectors.videoComponent),n=i.find(this.selectors.player),r=!!(t.fullScreen||t.webkitIsFullScreen||t.mozFullScreen||t.msFullscreenElement||t.fullscreenElement);i.find(this.selectors.component),i.find(".x-player-notification-container");r?t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen():i[0].requestFullscreen?i[0].requestFullscreen():i[0].mozRequestFullScreen?i[0].mozRequestFullScreen():i[0].webkitRequestFullScreen?i[0].webkitRequestFullScreen():i[0].msRequestFullscreen?i[0].msRequestFullscreen():"iPad"==this.md.tablet()&&n[0].webkitEnterFullscreen&&n[0].webkitEnterFullscreen()},onFullscreen:function(s){var o=!!(t.fullScreen||t.webkitIsFullScreen||t.mozFullScreen||t.msFullscreenElement||t.fullscreenElement),i=t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement;if(e(i).is(this.selectors.videoComponent)||this.$fullscreenTarg){var n=this.$fullscreenTarg?this.$fullscreenTarg:e(i),r=n.find(this.selectors.component),l=e(this.selectors.component).not(r),c=n.find(this.selectors.closeBtn),a=n.find(this.selectors.vidInner),d=n.find(this.selectors.fullscreenOnBtn),u=n.find(this.selectors.fullscreenOffBtn),h=n.find(this.selectors.ariaLive),f=r.find("[data-fullscreen-bookends]");if(o){if(this.$fullscreenTarg=e(i),l.hide(),c.hide(),a.css("height","100%"),n.addClass(this.classes.fullscreen),f.length<1){var m='<div tabindex="0" data-fullscreen-bookends></div>';e(m),e(m);r.prepend(m),r.append(m);var v=r.find(this.selectors.focusable);r.find("[data-fullscreen-bookends]").eq(0).on("focus",function(){v.eq(-2).focus()}).end().eq(1).on("focus",function(){v.eq(1).is(":visible")?v.eq(1).focus():v.eq(2).focus()})}u.show(),d.is(":focus")&&this.focus(u),d.hide(),setTimeout(function(){h.text("Fullscreen enabled")},0)}else this.$fullscreenTarg=null,l.show(),n.hasClass(this.classes.overlayPlayer)&&c.show(),a.removeAttr("style"),n.removeClass(this.classes.fullscreen),f.remove(),d.show(),u.is(":focus")&&this.focus(d),u.hide(),setTimeout(function(){h.text("Fullscreen disabled")},0)}},secondsToMinutes:function(e){var t,s,o;return o=Math.floor(e),t=Math.floor(e/60),s=o%60,s<10&&(s="0"+s),t+":"+s},minutesToSeconds:function(e){if(e.indexOf(":")>-1){var t=e.split(":");return(60*+t[0]+ +t[1]).toFixed(3)}return+e},toAccessibleTime:function(e){var t=parseInt(e/3600)%24,s=parseInt(e/60)%60,o=Math.floor(e)%60;return(t<1?"":t+" hour")+(t>1?"s":"")+(t>0?", ":" ")+(s<1?"":s+" minute")+(s>1?"s ":"")+(s>0?", ":" ")+(o<1?"":o+" second")+(o>1?"s ":"")},setRangeDragHandle:function(t){this.$dragTarg=e(t.target)},unsetRangeDragHandle:function(t){e(this.selectors.inputTime).prop("placeholder","--:--"),this.$dragTarg=null},onRangeClick:function(t){var s=e(t.target).find(this.selectors.rangeHandle);s.length||(s=e(t.target).closest(this.selectors.rangeThermometer).find(this.selectors.rangeHandle)),s.length&&(this.$dragTarg=s,this.onRangeDrag(t),this.unsetRangeDragHandle(null))},updateAriaLabel:function(t){var s=e(t.target).closest(this.selectors.videoComponent);if(s.length){var o=s.find(this.selectors.seekBar),i=s.find(this.selectors.player)[0];o.attr("aria-valuetext","Time "+this.toAccessibleTime(i.currentTime)+" of "+this.toAccessibleTime(i.duration))}},onRangeDrag:function(e){if(this.$dragTarg){var t=this.$dragTarg.closest(this.selectors.rangeThermometer),s=e.pageX,o=t.outerWidth(),i=t.offset().left,n=s-i;n<=0&&(n=0),n>=o&&(n=o);var r=(t.find(this.selectors.rangeHandle).offset().left,(n/o*100).toFixed(2)),l=r+"%";this.$dragTarg.css({left:l});var c=this.$dragTarg.closest(this.selectors.videoComponent),a=c.find(this.selectors.player),d=this.$dragTarg.closest(this.selectors.controlsGroup).find(".x-controls-hidden-range"),u=l.slice(0,-1);if(d.is(c.find(this.selectors.volumeBar)))u/=100,u=u.toFixed(2),u.toString(),u>=1&&(u=1),u<=0&&(u=0),a[0].volume=u;else if(d.is(c.find(this.selectors.seekBar))){var h=u/100*a[0].duration;a[0].currentTime=h;var f=c.find(this.selectors.inputTime);f.prop("placeholder",this.secondsToMinutes(h))}else console.log("unexpected scrubber target")}},updateTimeFromInput:function(t){var s=e(t.target),o=s.closest(this.selectors.rangeHandle),i=t.keyCode?t.keyCode:t.which,n=s.val(),r=s.closest(this.selectors.videoComponent),l=r.find(this.selectors.player),c=r.find(this.selectors.ariaLive);if(32==i||80==i||77==i||70==i||80==i||67==i||27==i||88==i)return void t.preventDefault();if(13==i){var n=this.minutesToSeconds(n),a=Number(n),d=l[0].duration;a>d&&(a=d),l[0].currentTime=a,s.val(""),o.removeClass("error"),c.text("Time "+this.toAccessibleTime(a)+" of "+this.toAccessibleTime(d))}else{if(-1!==e.inArray(t.keyCode,[46,8,9,27,13,110,186,59])||65===t.keyCode&&(!0===t.ctrlKey||!0===t.metaKey)||t.keyCode>=35&&t.keyCode<=40)return;(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()}t.stopPropagation()},updateRangeControl:function(e,t,s){var o=e.closest(this.selectors.controlsGroup),i=o.find(this.selectors.rangeFill),n=o.find(this.selectors.rangeHandle);s?(t*=100,i.css({width:t+"%"}),n.css({left:t+"%"})):(i.css({width:t+"%"}),n.css({left:t+"%"}))},showControls:function(t){var s=e(t.target).closest(this.selectors.videoComponent),o=s.find(this.selectors.component),i=s.find(this.selectors.closeBtn);o.length&&(o.addClass("show"),i.addClass("show"),clearTimeout(this.controlsTimeout),this.controlsTimeout=setTimeout(function(){this.hideControls()}.bind(this),this.hideDelay))},hideControls:function(){var t=e(this.selectors.component),s=t.closest(this.selectors.videoComponent).find(this.selectors.closeBtn);t.length&&(this.$dragTarg||t.find(this.selectors.inputTime+":focus").length?(clearTimeout(this.controlsTimeout),this.controlsTimeout=setTimeout(function(){this.hideControls()}.bind(this),this.hideDelay)):(t.removeClass("show"),s.removeClass("show")))},openShortcutsInfo:function(t){var s=e(t.target).closest(this.selectors.videoComponent),o=s.find(this.selectors.shortcutsInfo);o.find(this.selectors.shortcutsCloseBtn);if(o.length){if(o.find("[data-shortcut-bookends]").length<1){var i='<div tabindex="0" data-shortcut-bookends></div>';e(i),e(i);o.prepend(i),o.append(i);var n=o.find(this.selectors.focusable);o.find("[data-shortcut-bookends]").eq(0).on("focus",function(){n.eq(-2).focus()}).end().eq(1).on("focus",function(){n.eq(1).is(":visible")?n.eq(1).focus():n.eq(2).focus()})}o.addClass("show").attr("aria-hidden","false"),o.siblings().attr("tabindex","-1").attr("aria-hidden","true"),setTimeout(function(){o.find('[role="document"]').focus(),s.find(this.selectors.ariaLive).text("Shortcuts info opened. Press Escape to close it")}.bind(this),100)}},closeShortcutsInfo:function(t){var s=e(t.target).closest(this.selectors.videoComponent),o=s.find(this.selectors.shortcutsInfo),i=s.find(this.selectors.ariaLive);o.length&&(o.find("[data-shortcut-bookends]").remove(),o.removeClass("show").attr("aria-hidden","true"),o.siblings().removeAttr("tabindex").attr("aria-hidden","false"),i.text("Shortcuts info closed"),s.find(this.selectors.shortcutsBtn).focus())},onKeyDown:function(t){var s=t.keyCode?t.keyCode:t.which,o=e(t.currentTarget),i=o.find(this.selectors.player)[0],n=o.find(this.selectors.ariaLive);switch(s){case 80:case 32:i.paused?i.play():i.pause();break;case 38:var r=i.volume+.1;r>1&&(r=1),i.volume=r,n.text("Volume "+Math.round(100*r)+"%"),t.preventDefault();break;case 40:var r=i.volume-.1;r<0&&(r=0),i.volume=r,n.text("Volume "+Math.round(100*r)+"%"),t.preventDefault();break;case 39:var l=t.shiftKey?60:15,c=i.currentTime+l;c>i.duration&&(c=i.duration),i.currentTime=c,n.text("Time "+this.toAccessibleTime(c)+" of "+this.toAccessibleTime(i.duration)),e(this.selectors.inputTime).prop("placeholder",this.secondsToMinutes(c)),this.notificationTimeout=setTimeout(function(){e(this.selectors.inputTime).prop("placeholder","--:--")}.bind(this),500),t.preventDefault();break;case 37:var l=t.shiftKey?60:15,c=i.currentTime-l;c<0&&(c=0),i.currentTime=c,n.text("Time "+this.toAccessibleTime(c)+" of "+this.toAccessibleTime(i.duration)),e(this.selectors.inputTime).prop("placeholder",this.secondsToMinutes(c)),this.notificationTimeout=setTimeout(function(){e(this.selectors.inputTime).prop("placeholder","--:--")}.bind(this),500),t.preventDefault();break;case 77:var a=o.find(this.selectors.muteBtn),d=o.find(this.selectors.unmuteBtn);a.is(":visible")?a.trigger("click"):d.is(":visible")&&d.trigger("click");break;case 70:var u=o.find(this.selectors.fullscreenOnBtn),h=o.find(this.selectors.fullscreenOffBtn);u.is(":visible")?u.trigger("click"):h.is(":visible")&&h.trigger("click");break;case 67:var f=o.find(this.selectors.captionOnBtn),m=o.find(this.selectors.captionOffBtn);f.is(":visible")?f.trigger("click"):m.is(":visible")&&m.trigger("click");break;case 88:o.find(this.selectors.closeBtn).trigger("click");break;case 27:var v=o.find(this.selectors.shortcutsInfo);v.find("[data-shortcut-bookends]").length?v.find(this.selectors.shortcutsCloseBtn).trigger("click"):o.find(this.selectors.closeBtn).trigger("click");break;case 74:t.preventDefault(),o.find(this.selectors.inputTime).focus();break;case 191:t.shiftKey&&!this.md.mobile()&&o.find(this.selectors.shortcutsBtn).trigger("click")}},preventDefaultKeySpacebar:function(e){32==(e.keyCode?e.keyCode:e.which)&&e.preventDefault()},preventArrowShortcuts:function(e){var t=e.keyCode?e.keyCode:e.which;t>36&&t<41&&e.stopPropagation()},focus:function(e){this.md.mobile()?setTimeout(function(){e.focus()},100):e.focus()},announce:function(e,t){e.text(t),setTimeout(function(){e.text("")},50)},onLoadStart:function(t){var s=e(t.target)[0],o=e(t.target).closest(this.selectors.videoComponent),i=o.find(this.selectors.ariaLive);o.length&&s.addEventListener("timeupdate",this.onTimeUpdate.bind(this),!0),i.text("Video buffering")},toActiveMode:function(t){var s=e(t.target);if(s.is(this.selectors.videoComponent)){var o=s.find(this.selectors.player)[0],i=s.find(this.selectors.component),n=s.find(this.selectors.ariaLive);s.removeClass("x--background-mode").addClass("x--active-mode"),i.show().trigger("mousemove"),n.text("Video activated"),o.currentTime=0,o.volume=1,e(o).prop("muted",!1).prop("loop",!1)}},toBackgroundMode:function(t){var s=e(t.target);if(s.is(this.selectors.videoComponent)){var o=s.find(this.selectors.player)[0],i=s.find(this.selectors.component);s.find(this.selectors.ariaLive);s.addClass("x--background-mode").removeClass("x--active-mode"),i.hide(),o.volume=0,o.play(),e(o).prop("autoplay",!0).prop("loop",!0)}},bindListeners:function(){var s=(e(window),e(t));e(this.selectors.component);t.addEventListener("play",this.onPlay.bind(this),!0),t.addEventListener("pause",this.onPause.bind(this),!0),t.addEventListener("volumechange",this.onVolumeChange.bind(this),!0),t.addEventListener("durationchange",this.onDurationChange.bind(this),!0),t.addEventListener("loadstart",this.onLoadStart.bind(this),!0),s.on("input.x-video change.x-video",this.selectors.volumeBar,this.updateVolume.bind(this)),s.on("click.x-video",this.selectors.muteBtn,this.onMuteClick.bind(this)),s.on("click.x-video",this.selectors.unmuteBtn,this.onUnmuteClick.bind(this)),s.on("focus.x-video",this.selectors.volumeBar+", "+this.selectors.muteBtn+", "+this.selectors.unmuteBtn,this.openVolumeControls.bind(this)),s.on("focusout.x-video",this.selectors.volumeBar+", "+this.selectors.muteBtn+", "+this.selectors.unmuteBtn,this.closeVolumeControls.bind(this)),s.on("click.x-video",this.selectors.fullscreenOnBtn+", "+this.selectors.fullscreenOffBtn,this.toggleFullscreen.bind(this)),s.on("webkitfullscreenchange mozfullscreenchange fullscreenchange fullscreenChange MSFullscreenChange",this.onFullscreen.bind(this)),s.on("click.x-video",".x-player-notification-container",this.togglePlayPause.bind(this)),s.on("click.x-video press.x-video",this.selectors.playBtn,this.onPlayClick.bind(this)),s.on("click.x-video press.x-video",this.selectors.pauseBtn,this.onPauseClick.bind(this)),s.on("click.x-video",this.selectors.captionOnBtn,this.onCaptionShowClick.bind(this)),s.on("click.x-video",this.selectors.captionOffBtn,this.onCaptionHideClick.bind(this)),s.on("input.x-video change.x-video",this.selectors.seekBar,this.updateTime.bind(this)),s.on("click.x-video",".x-range-control",this.onRangeClick.bind(this)),s.on("mousedown.x-video touchstart.x-video",this.selectors.rangeHandle,this.setRangeDragHandle.bind(this)),s.on("mousemove.x-video touchmove.x-video",this.onRangeDrag.bind(this)),s.on("mouseup.x-video touchend.x-video",this.unsetRangeDragHandle.bind(this)),s.on("focus.x-video",this.selectors.seekBar,this.updateAriaLabel.bind(this)),s.on("keydown",this.selectors.inputTime,this.updateTimeFromInput.bind(this)),s.on("mousedown mouseup mousemove click",this.selectors.inputTime,this.unsetRangeDragHandle.bind(this)),s.on("mousemove.x-video click.x-video touchstart.x-video",this.selectors.vidInner,this.showControls.bind(this)),s.on("focus.x-video",this.selectors.videoComponent+" button, "+this.selectors.videoComponent+" input",this.showControls.bind(this)),s.on("input.x-video change.x-video",this.selectors.volumeBar+", "+this.selectors.seekBar,this.showControls.bind(this)),s.on("keydown.x-video",this.selectors.videoComponent,this.onKeyDown.bind(this)),s.on("keydown.x-video",this.selectors.videoComponent+" input",this.preventArrowShortcuts.bind(this)),s.on("keydown.x-video keypress.x-video keyup.x-video",this.selectors.videoComponent+" button",this.preventDefaultKeySpacebar.bind(this)),"iPad"==this.md.tablet()&&s.on("touchstart.x-video",".x-player-notification-container",this.togglePlayPause.bind(this)),s.on("click.x-video",this.selectors.shortcutsBtn,this.openShortcutsInfo.bind(this)),s.on("click.x-video",this.selectors.shortcutsCloseBtn,this.closeShortcutsInfo.bind(this)),s.on("activateVideo",this.selectors.videoComponent,this.toActiveMode.bind(this)),s.on("backgroundVideo",this.selectors.videoComponent,this.toBackgroundMode.bind(this)),this.updateRangeControl(e(this.selectors.volumeBar),1,!0)}}).initialize()}(jQuery,document);
!function(e,t,s){"use strict";({id:"video",version:.1,classes:{show:"show",hide:"_hide",active:"_active",fullscreen:"fullscreen",vidLoaded:"_videoLoaded",vidVisible:"x-video--visible",vidOpen:"x-video--open",overlayPlayer:"x-player-overlay",bgOverlayPlayer:"x-player-background-overlay"},selectors:{contentBanner:".x-content-banner",vidInner:".x-video-inner",player:"video.x-player-video",launchOverlayBtn:'[data-component="x-video-launch"]',closeBtn:".x-player-close-btn",captionBtnGroup:".x-controls-captions-group",playBtn:".x-controls-button--play",pauseBtn:".x-controls-button--pause",shortcutsInfo:".x-player-shortcuts-container",transEndEvents:"webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend webkitAnimationEnd oanimationend msAnimationEnd animationend",focusable:"a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]"},templateOptions:{interpolate:/{{([\s\S]+?)}}/g},md:new MobileDetect(window.navigator.userAgent),initialize:function(){this.selectors.component="[data-"+this.id+"]",_.forEach(this.classes,_.bind(function(e,t){this.selectors[t]="."+e},this)),this.bindListeners()},contentEditorLoadVid:function(t){t.not(this.selectors.overlayPlayer).each(function(t,s){var i=e(s);i.addClass(this.classes.vidLoaded),this.createVideo(i),i.addClass(this.classes.vidVisible)}.bind(this))},lazyLoadContentVid:function(t){var s=e(window),i=s.scrollTop(),o=i+s.height(),n=t.offset().top,a=n;t.hasClass(this.classes.vidLoaded)||o>a&&(t.addClass(this.classes.vidLoaded),this.createVideo(t))},launchOverlayVid:function(t){var s=e(t.target),i=s.closest(this.selectors.contentBanner);if(s.prev(this.selectors.component).length){var o=s.prev(this.selectors.component);i.prepend(o),i.css("position","relative")}else var o=s.closest(this.selectors.contentBanner).find(this.selectors.component);if(e(this.selectors.component).not(o).find(this.selectors.closeBtn).trigger("click"),i.siblings().attr("tabindex","-1").attr("aria-hidden","true"),i.find(this.selectors.launchOverlayBtn).attr("tabindex","-1").attr("aria-hidden","true"),o.addClass(this.classes.active),o.hasClass(this.classes.vidLoaded))this.openOverlay(o);else{if("iPhone"==this.md.phone()){var n=e('<div class="x--vh" aria-live="polite">Overlay video activated. Swipe back and double tap to start</div>');o.append(n)}if("AndroidOS"==this.md.os()){var n=e('<div class="x--vh" aria-live="polite">Overlay video activated. Click play button to start</div>');o.append(n)}this.createVideo(o)}this.addBookends(),setTimeout(function(){i.find(this.selectors.closeBtn).addClass(this.classes.show).focus(),this.md.phone()&&n.html("")}.bind(this),600)},createVideo:function(s){var i=s.attr("data-video-props")?JSON.parse(s.attr("data-video-props")):{},o=s.find(this.selectors.vidInner),n=e("[data-video-controls-template]").html();o=e("<div />",{class:"x-video-inner"}),s.append(o);var a={class:"x-player-video",poster:i.poster};"custom"==i.controls&&"AndroidOS"==this.md.os()&&(a["aria-hidden"]="true");var d=e("<video />",a);if(_.forEach(i.urls,function(t){var s=e("<source />",{src:t.src,type:t.type});d.append(s)}),void 0!==i.captions&&i.captions.length&&_.forEach(i.captions,function(t){var s=e("<track />",{src:t.src,kind:t.kind,label:t.label,srclang:t.srclang});"true"==t.default&&s.prop("default",!0),d.append(s)}),i.muted&&d.prop("muted","muted"),i.loop&&d.attr("loop",""),i.autoplay&&d.attr("autoplay",""),"native"!=i.controls&&"iPhone"!=this.md.phone()||d.attr("controls",""),o.append(d),"custom"==i.controls&&"iPhone"!=this.md.phone()){var r=_.template(n,{interpolate:/{{([\s\S]+?)}}/g}),l=this.md.mobile()?"mobile":"";"iPhone"==this.md.phone()&&(l="iphone"),o.append(r({data:i,device:l})),i.backgroundMode&&s.trigger("backgroundVideo"),(void 0===i.captions||i.captions.length<1)&&o.find(this.selectors.captionBtnGroup).hide(),t.msFullscreenEnabled&&o.find(".full-screen-shortcut-title").hide()}setTimeout(function(){s.hasClass(this.classes.overlayPlayer)&&(s.addClass(this.classes.vidOpen),s.addClass(this.classes.vidLoaded),this.centerVid()),s.addClass(this.classes.vidVisible)}.bind(this),500)},closePlayer:function(t){var s=e(t.target),i=s.closest(this.selectors.component),o=(i.find(this.selectors.vidInner),i.find(this.selectors.player)[0]),n=i.closest(this.selectors.contentBanner),a=n.find(this.selectors.launchOverlayBtn),d=i.find(this.selectors.shortcutsInfo);if(o&&!i.hasClass("x--background-mode")){if(i.hasClass("x--active-mode"))return void i.trigger("backgroundVideo");o.pause(),i.removeClass(this.classes.vidVisible),i.removeClass(this.classes.vidOpen),i.removeClass(this.classes.active),this.removeBookends(),d.removeClass("show"),d.find("[data-shortcut-bookends]").remove(),n.siblings().removeAttr("tabindex").attr("aria-hidden","false"),n.find(this.selectors.launchOverlayBtn).removeAttr("tabindex").attr("aria-hidden","false")}a.focus()},openOverlay:function(e){var t=e.attr("data-video-props")?JSON.parse(e.attr("data-video-props")):{},s=e.find(this.selectors.player)[0];e.addClass(this.classes.vidOpen),this.centerVid(),e.addClass(this.classes.vidVisible),t.startOver&&(s.currentTime=0),s.play()},centerVid:function(){var t=e(this.selectors.overlayPlayer+this.selectors.active),s=t.find(this.selectors.vidInner);if(t.length)if(t.hasClass(this.classes.fullscreen))t.css("height","100%"),s.removeAttr("style").css("height","100%");else{var i=t.closest(this.selectors.contentBanner),o=(t.outerHeight(),i.outerHeight());t.css("height",o),s.removeAttr("style");var n=s.outerHeight();if(n>=o||n<50){s.css({position:"relative",height:"100%",top:"auto","margin-top":"auto"});var a=t.find(this.selectors.player)[0],d=Math.round(a.videoWidth/a.videoHeight*o);s.css({width:d+"px"})}else s.css({position:"absolute",height:"auto",top:"50%","margin-top":-n/2+"px"})}},addBookends:function(){var t=e(this.selectors.component+this.selectors.active);if(t.find("[data-bookends]").length>0)return!0;t.prepend('<div tabindex="0" data-bookends></div>'),t.append('<div tabindex="0" data-bookends></div>'),this.bookendFocus()},bookendFocus:function(){var t=e(this.selectors.component+this.selectors.active),s=t.find("[data-bookends]"),i=t.find(this.selectors.focusable);_.isEmpty(s)||s.eq(0).on("focus",function(){i.eq(-5).focus()}).end().eq(1).on("focus",function(){i.eq(1).focus()})},removeBookends:function(){e(this.selectors.component).find("[data-bookends]").remove()},bindListeners:function(){var s=e(window),i=e(t),o=e(this.selectors.component);o.length&&(o.each(function(t,i){var o=e(i);o.hasClass(this.classes.overlayPlayer)||(s.on("scroll.x-video",_.throttle(this.lazyLoadContentVid.bind(this,o),200)),this.lazyLoadContentVid(o))}.bind(this)),s.on("resize.x-video, orientationchange.x-video",_.debounce(this.centerVid.bind(this),300)),t.addEventListener("loadedmetadata",this.centerVid.bind(this),!0),i.on("click.x-video",this.selectors.launchOverlayBtn,this.launchOverlayVid.bind(this)),i.on("click.x-video",this.selectors.closeBtn,this.closePlayer.bind(this)))}}).initialize()}(jQuery,document);